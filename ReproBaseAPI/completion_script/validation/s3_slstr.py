import requests
from openpyxl import load_workbook
from datetime import datetime 
from requests import Request, Session

s = Session()
s.auth = ('user', '*K7KzTrZWhC2zkc')

mission = "S3SLSTR"
periods_dict = {}

static_aux = [
"S3A_SL_1_O_F1AX_20160216T000000_20991231T235959_20170324T120000___________________MPC_O_AL_006.SEN3",
"S3B_SL_1_O_F1AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_1_O_F2AX_20160216T000000_20991231T235959_20170324T120000___________________MPC_O_AL_006.SEN3",
"S3B_SL_1_O_F2AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_N_S1AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_009.SEN3",
"S3B_SL_1_N_S1AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_N_S2AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_009.SEN3",
"S3B_SL_1_N_S2AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_N_S3AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_009.SEN3",
"S3B_SL_1_N_S3AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_O_S1AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_011.SEN3",
"S3A_SL_1_O_S2AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_011.SEN3",
"S3A_SL_1_O_S3AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_011.SEN3",
"S3B_SL_1_O_S1AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_O_S2AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_O_S3AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_NAS4AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3A_SL_1_NAS5AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3A_SL_1_NAS6AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3B_SL_1_NAS4AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_NAS5AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_NAS6AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_NBS4AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3A_SL_1_NBS5AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3A_SL_1_NBS6AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_010.SEN3",
"S3B_SL_1_NBS4AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_NBS5AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_NBS6AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_OAS4AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3A_SL_1_OAS5AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3A_SL_1_OAS6AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3B_SL_1_OAS4AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_OAS5AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_OAS6AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_OBS4AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3A_SL_1_OBS5AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3A_SL_1_OBS6AX_20160418T094050_20991231T235959_20180202T120000___________________MPC_O_AL_012.SEN3",
"S3B_SL_1_OBS4AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_OBS5AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_OBS6AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_VIC_AX_20160216T000000_20991231T235959_20161012T120000___________________MPC_O_AL_004.SEN3",
"S3B_SL_1_VIC_AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_1_GEO_AX_20160216T000000_20991231T235959_20190912T120000___________________MPC_O_AL_008.SEN3",
"S3B_SL_1_GEO_AX_20180425T000000_20991231T235959_20190912T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_1_ESSTAX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_ESSTAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_CLO_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_006.SEN3",
"S3B_SL_1_CLO_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_IRE_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_IRE_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_LCC_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_LCC_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_CDP_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_CDP_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_CLP_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_CLP_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_ADJ_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_ADJ_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_RTT_AX_20160216T000000_20991231T235959_20180202T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_1_RTT_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_1_MCHDAX_20160216T000000_20991231T235959_20170120T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_1_MCHDAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3__AX___DEM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__AX___LWM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__AX___OOM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__AX___TRM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__AX___CLM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_PCP_AX_20160216T000000_20991231T235959_20180219T120000___________________MPC_O_AL_005.SEN3",
"S3B_SL_2_PCP_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S6N_AX_20160216T000000_20991231T235959_20190930T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_2_S7N_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S8N_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S9N_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S6N_AX_20180425T000000_20991231T235959_20190930T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S7N_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S8N_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S9N_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_F1N_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_F1N_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S7O_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S8O_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_S9O_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S7O_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S8O_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_S9O_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_N2_CAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_2_N3RCAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_2_N3_CAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_2_N2_CAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_N3RCAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_N3_CAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_D2_CAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_003.SEN3",
"S3A_SL_2_D3_CAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_2_D2_CAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_D3_CAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3__SL_2_SST_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_SDI2AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_SDI3AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_SDI2AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SL_2_SDI3AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_SSESAX_20000101T000000_20991231T235959_20160721T120000___________________MPC_O_AL_002.SEN3",
"S3B_SL_2_SSESAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_LSTCAX_20160216T000000_20991231T235959_20190215T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_2_LSTCAX_20180425T000000_20991231T235959_20190215T120000___________________MPC_O_AL_002.SEN3",
"S3__SL_2_LSTBAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SL_2_LSTVAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SL_2_LSTWAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_LSTEAX_20160216T000000_20991231T235959_20170116T120000___________________MPC_O_AL_002.SEN3",
"S3B_SL_2_LSTEAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_SL_2_FRPTAX_20160216T000000_20991231T235959_20191115T120000___________________MPC_O_AL_003.SEN3",
"S3B_SL_2_FRPTAX_20180425T000000_20991231T235959_20191115T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_2_FXPAAX_20160216T000000_20991231T235959_20190930T120000___________________MPC_O_AL_002.SEN3",
"S3B_SL_2_FXPAAX_20180425T000000_20991231T235959_20190930T120000___________________MPC_O_AL_001.SEN3",
"S3__SL_2_CFM_AX_20160216T000000_20991231T235959_20190930T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_2_PCPFAX_20160216T000000_20991231T235959_20200708T120000___________________MPC_O_AL_004.SEN3",
"S3B_SL_2_PCPFAX_20180425T000000_20991231T235959_20200708T120000___________________MPC_O_AL_003.SEN3",
"S3__SL_2_PLFMAX_20160216T000000_20991231T235959_20190930T120000___________________MPC_O_AL_002.SEN3",
"S3A_SL_2_SXPAAX_20160216T000000_20991231T235959_20190930T120000___________________MPC_O_AL_002.SEN3",
"S3B_SL_2_SXPAAX_20180425T000000_20991231T235959_20190930T120000___________________MPC_O_AL_001.SEN3"
]

static_aux_A = []
static_aux_B = []

for aux in static_aux:
    if "S3B" not in aux:
        static_aux_A.append(aux)

for aux in static_aux:
    if "S3A" not in aux:
        static_aux_B.append(aux)


periods_dict["20160216T000000-20190101T000000-A"] = [["S3A_SL_1_GEC_AX_20160216T000000_20991231T235959_20190912T120000___________________MPC_O_AL_008.SEN3"] + static_aux_A ,'A']
periods_dict["20190101T000000-20991231T235959-A"] = [["S3A_SL_1_GEC_AX_20190101T000000_20991231T235959_20191010T120000___________________MPC_O_AL_009.SEN3"] + static_aux_A ,'A']
periods_dict["20180425T000000-20190101T000000-B"] = [["S3B_SL_1_GEC_AX_20180425T000000_20991231T235959_20181002T120000___________________MPC_O_AL_003.SEN3"] + static_aux_B,'B']
periods_dict["20190101T000000-20991231T235959-B"] = [["S3B_SL_1_GEC_AX_20190101T000000_20991231T235959_20191010T120000___________________MPC_O_AL_004.SEN3"] + static_aux_B,'B']


    
for period in periods_dict :

    checks = {}

    print(period.strip())
    start = period.strip().split('-')[0]
    stop = period.strip().split('-')[1]

    start = datetime.strptime(start, '%Y%m%dT%H%M%S').strftime('%Y-%m-%dT%H:%M:%SZ')
    stop = datetime.strptime(stop, '%Y%m%dT%H%M%S').strftime('%Y-%m-%dT%H:%M:%SZ')

    unit = periods_dict[period][1]
    # GET request 
    request="https://reprocessing-auxiliary.copernicus.eu/reprocessing.svc/GetReproBaselineNamesForPeriod(Mission='%s',Unit='%s',SensingTimeStart='%s',SensingTimeStop='%s')" % (mission,unit,start,stop)

    # print(request)

    r = s.get(request)
    response_list = r.json()['value']

    for expected_aux in periods_dict[period][0]:
        aux_found = False
        for element in response_list:
            if expected_aux in element :
                # print( expected_aux , "OK") 
                checks[expected_aux] = "OK"
                aux_found = True
                break
        if aux_found == False:
            # print( expected_aux , "KO")
            checks[expected_aux] = "KO"

    # print(period.strip())
    start = period.strip().split('-')[0]
    stop = period.strip().split('-')[1]
    
    # write report 
    file = open(r"test-%s-%s-%s-%s.txt" % (mission,unit,start,stop),"w")

    for check in checks:
        file.write( "%s\t%s" %  (check,checks[check]) )
        file.write( "\n")
        print( "%s\t\t%s" %  (check,checks[check]) )
        # print(" ")

    
    file.write( "\n")
    file.write( "\n")

    file.write( "\tGET %s " % request)
    file.write( "\n")
    file.write( "\n")

    for element in response_list:
        file.write("\t fullname : %s " % element )
        file.write( "\n")

    file.close()




