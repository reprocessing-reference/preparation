import requests
from openpyxl import load_workbook
from datetime import datetime 
from requests import Request, Session

s = Session()
s.auth = ('user', '*K7KzTrZWhC2zkc')

mission = "S3SRAL"
periods_dict = {}


static_aux = [
"S3A_MW_1_SLC_AX_20160216T000000_20991231T235959_20190621T120000___________________MPC_O_AL_003.SEN3",
"S3B_MW_1_SLC_AX_20180425T000000_20991231T235959_20190621T120000___________________MPC_O_AL_002.SEN3",
"S3A_MW___CHDNAX_20160216T000000_20991231T235959_20170908T120000___________________MPC_O_AL_004.SEN3",
"S3A_MW___CHDRAX_20160216T000000_20991231T235959_20170908T120000___________________MPC_O_AL_004.SEN3",
"S3B_MW___CHDNAX_20180425T000000_20991231T235959_20181116T120000___________________MPC_O_AL_002.SEN3",
"S3B_MW___CHDRAX_20180425T000000_20991231T235959_20181116T120000___________________MPC_O_AL_002.SEN3",
"S3A_MW___STD_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_MW___STD_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3A_AX___OSF_AX_20160216T192404_99991231T235959_20200826T081958___________________EUM_O_AL_001.SEN3",
"S3B_AX___OSF_AX_20180425T191855_99991231T235959_20200826T092034___________________EUM_O_AL_001.SEN3",
"S3__AX___CST_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR___LSM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR___CHDNAX_20160216T000000_20991231T235959_20200312T120000___________________MPC_O_AL_006.SEN3",
"S3B_SR___CHDNAX_20180425T000000_20991231T235959_20200312T120000___________________MPC_O_AL_005.SEN3",
"S3A_SR_1_CONCAX_20160216T000000_20991231T235959_20171130T120000___________________MPC_O_AL_003.SEN3",
"S3A_SR_1_CONMAX_20160216T000000_20991231T235959_20180213T120000___________________MPC_O_AL_007.SEN3",
"S3B_SR_1_CONCAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_1_CONMAX_20180425T000000_20991231T235959_20200722T120000___________________MPC_O_AL_004.SEN3",
"S3__SR_2_CP00AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_CP06AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_CP12AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_CP18AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_EOT1AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_EOT2AX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_FLT_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_GEO_AX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_LNEQAX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_LRC_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_LT2_AX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_LT1_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_LUTEAX_20160216T000000_20991231T235959_20170713T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_LUTFAX_20160216T000000_20991231T235959_20170713T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_LUTSAX_20160216T000000_20991231T235959_20181127T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_MAG_AX_20160216T000000_20991231T235959_20170811T140000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_MDT_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_MLM_AX_20160216T000000_20991231T235959_20200512T120000___________________MPC_O_AL_004.SEN3",
"S3__SR_2_MSMGAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_MSS1AX_20160216T000000_20991231T235959_20170713T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_MSS2AX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_ODLEAX_20160216T000000_20991231T235959_20170322T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_RET_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_RRC_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_S1AMAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_S1PHAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_S2AMAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_S2PHAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD01AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD02AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD03AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD04AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD05AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD06AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD07AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD08AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD09AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD10AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD11AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SD12AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SET_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SFL_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SHD_AX_20160216T000000_20991231T235959_20200220T120000___________________MPC_O_AL_003.SEN3",
"S3__SR_2_SI01AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI02AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI03AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI04AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI05AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI06AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI07AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI08AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI09AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI10AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI11AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SI12AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SIGLAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SIGSAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SSM_AX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_SST_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3__SR_2_SURFAX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_WNDLAX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_002.SEN3",
"S3__SR_2_WNDSAX_20160216T000000_20991231T235959_20190402T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_CCT_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_CCT_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC01AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC02AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC03AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC04AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC05AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC06AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC07AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC08AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC09AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_IC10AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_SSBLAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_SSBSAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
"S3B_SR_2_CON_AX_20180425T000000_20991231T235959_20200407T120000___________________MPC_O_AL_008.SEN3",
"S3A_SR_2_CON_AX_20160216T000000_20991231T235959_20200407T120000___________________MPC_O_AL_017.SEN3",
"S3A_SR_2_SSBLAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR_2_SSBSAX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR_2_IC01AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC02AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR_2_IC03AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC04AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR_2_IC05AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC06AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
"S3A_SR_2_IC07AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC08AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC09AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3",
"S3A_SR_2_IC10AX_20160216T000000_20991231T235959_20161010T120000___________________MPC_O_AL_002.SEN3"]


static_aux_A = []
static_aux_B = []

for aux in static_aux:
    if "S3B" not in aux:
        static_aux_A.append(aux)

for aux in static_aux:
    if "S3A" not in aux:
        static_aux_B.append(aux)

periods_dict["20160216T000000-20991231T235959-A"] = [
    [
        "S3A_MW_1_SLC_AX_20160216T000000_20991231T235959_20190621T120000___________________MPC_O_AL_003.SEN3",
        "S3A_MW___CHDNAX_20160216T000000_20991231T235959_20170908T120000___________________MPC_O_AL_004.SEN3",
        "S3A_MW___CHDRAX_20160216T000000_20991231T235959_20170908T120000___________________MPC_O_AL_004.SEN3",
        "S3A_MW___STD_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
        "S3__AX___CST_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
        "S3__SR___LSM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
        "S3A_SR_1_CONCAX_20160216T000000_20991231T235959_20171130T120000___________________MPC_O_AL_003.SEN3",
        "S3A_SR_1_CONMAX_20160216T000000_20991231T235959_20180213T120000___________________MPC_O_AL_007.SEN3",
        "S3A_SR___CHDNAX_20160216T000000_20991231T235959_20200312T120000___________________MPC_O_AL_006.SEN3",
    ] + static_aux_A ,'A']
periods_dict["20180425T000000-20991231T235959-B"] = [
    [
        "S3B_MW_1_SLC_AX_20180425T000000_20991231T235959_20190621T120000___________________MPC_O_AL_002.SEN3",
        "S3B_MW___CHDNAX_20180425T000000_20991231T235959_20181116T120000___________________MPC_O_AL_002.SEN3",
        "S3B_MW___CHDRAX_20180425T000000_20991231T235959_20181116T120000___________________MPC_O_AL_002.SEN3",
        "S3B_MW___STD_AX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
        "S3__AX___CST_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
        "S3__SR___LSM_AX_20000101T000000_20991231T235959_20151214T120000___________________MPC_O_AL_001.SEN3",
        "S3B_SR_1_CONCAX_20180425T000000_20991231T235959_20180409T120000___________________MPC_O_AL_001.SEN3",
        "S3B_SR_1_CONMAX_20180425T000000_20991231T235959_20200722T120000___________________MPC_O_AL_004.SEN3",
        "S3B_SR___CHDNAX_20180425T000000_20991231T235959_20200312T120000___________________MPC_O_AL_005.SEN3"
        ] + static_aux_B ,'B']


for period in periods_dict :

    checks = {}

    print(period.strip())
    start = period.strip().split('-')[0]
    stop = period.strip().split('-')[1]

    start = datetime.strptime(start, '%Y%m%dT%H%M%S').strftime('%Y-%m-%dT%H:%M:%SZ')
    stop = datetime.strptime(stop, '%Y%m%dT%H%M%S').strftime('%Y-%m-%dT%H:%M:%SZ')

    unit = periods_dict[period][1]
    # GET request 
    request="https://reprocessing-preparation.ml/reprocessing.svc/GetReproBaselineNamesForPeriod(Mission='%s',Unit='%s',SensingTimeStart='%s',SensingTimeStop='%s')" % (mission,unit,start,stop)

    # print(request)

    r = s.get(request)
    out_list = r.json()['value']

    for expected_aux in periods_dict[period][0]:
        aux_found = False
        for element in out_list:
            if expected_aux in element :
                # print( expected_aux , "OK")
                checks[expected_aux] = "OK"
                aux_found = True
                break
        if aux_found == False:
            # print( expected_aux , "KO")
            checks[expected_aux] = "KO"

    # print(period.strip())
    start = period.strip().split('-')[0]
    stop = period.strip().split('-')[1]

    # write report 
    file = open(r"test-%s-%s-%s-%s.txt" % (mission,unit,start,stop),"w")

    for check in checks:
        file.write( "%s\t%s" %  (check,checks[check]) )
        file.write( "\n")
        print( "%s\t\t%s" %  (check,checks[check]) )
        # print(" ")

    
    file.write( "\n")
    file.write( "\n")

    file.write( "\tGET %s " % request)
    file.write( "\n")
    file.write( "\n")
    for element in out_list:
        file.write("\t fullname : %s " % element )
        file.write( "\n")

    file.close()




