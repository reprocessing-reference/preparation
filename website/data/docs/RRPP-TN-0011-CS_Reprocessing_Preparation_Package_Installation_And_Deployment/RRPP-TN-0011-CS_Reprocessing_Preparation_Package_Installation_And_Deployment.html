<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>...</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="../../../assets/css/styledoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 24%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="header">
<th>Description</th>
<th>Version</th>
<th>Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Issued</td>
<td>1.0</td>
<td>10/05/2021</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Change Log:</strong></p>
<p>Table of contents</p>
<p></p>
<p><a href="#introduction">1. INTRODUCTION <a
href="#introduction">5</a></a></p>
<p><a href="#purpose-and-scope">1.1 Purpose and scope <a
href="#purpose-and-scope">5</a></a></p>
<p><a href="#documents">1.2 Documents <a href="#documents">5</a></a></p>
<p><a href="#reference-documents">1.2.1 Reference documents <a
href="#reference-documents">5</a></a></p>
<p><a href="#applicable-documents">1.2.2 Applicable documents <a
href="#applicable-documents">5</a></a></p>
<p><a href="#terminology">1.3 Terminology <a
href="#terminology">6</a></a></p>
<p><a href="#definitions">1.3.1 Definitions <a
href="#definitions">6</a></a></p>
<p><a href="#list-of-acronyms">1.3.2 List of Acronyms <a
href="#list-of-acronyms">6</a></a></p>
<p><a href="#sentinels-reprocessing-preparation-package">2. SENTINELS
REPROCESSING PREPARATION PACKAGE <a
href="#sentinels-reprocessing-preparation-package">7</a></a></p>
<p><a href="#overview">2.1 Overview <a href="#overview">7</a></a></p>
<p><a href="#sentinels-reprocessing-preparation-package-1">2.2 Sentinels
Reprocessing Preparation Package <a
href="#sentinels-reprocessing-preparation-package-1">7</a></a></p>
<p><a
href="#sentinels-reprocessing-preparation-package-interface-context">3.
SENTINELS REPROCESSING PREPARATION PACKAGE INTERFACE CONTEXT <a
href="#sentinels-reprocessing-preparation-package-interface-context">8</a></a></p>
<p><a href="#installation-and-deployment-manual">4. INSTALLATION AND
DEPLOYMENT MANUAL <a
href="#installation-and-deployment-manual">9</a></a></p>
<p><a href="#overview-1">4.1 Overview <a
href="#overview-1">9</a></a></p>
<p><a href="#installation-and-deployment-requirements">4.2 Installation
and Deployment requirements <a
href="#installation-and-deployment-requirements">9</a></a></p>
<p><a href="#build-docker-images">4.3 Build docker images <a
href="#build-docker-images">9</a></a></p>
<p><a href="#deployment-as-docker-compose-applications">4.4 Deployment
as docker-compose applications <a
href="#deployment-as-docker-compose-applications">10</a></a></p>
<p><a href="#appendices">5. APPENDICES <a
href="#appendices">11</a></a></p>
<p><a href="#auxip-pom-file">5.1 AUXIP POM file <a
href="#auxip-pom-file">11</a></a></p>
<p><a href="#auxip-docker-compose-file">5.2 AUXIP docker-compose file <a
href="#auxip-docker-compose-file">11</a></a></p>
<h1 id="introduction">INTRODUCTION</h1>
<h2 id="purpose-and-scope">Purpose and scope</h2>
<p>This document details the installation and the deployment of
Sentinels Reprocessing Preparation package.</p>
<p>The reprocessing Preparation package contains three main tasks:</p>
<ul>
<li><p>The Reprocessing Configuration Baseline API.</p></li>
<li><p>The AUXIP API.</p></li>
<li><p>The Reprocessing Data Baseline API.</p>
<ol type="1">
<li><h2 id="documents">Documents</h2>
<ol type="1">
<li><h3 id="reference-documents">Reference documents</h3></li>
</ol></li>
</ol></li>
</ul>
<ol type="1">
<li><p>OData Documentation <a
href="http://www.odata.org/documentation">http://www.odata.org/documentation</a></p></li>
<li><p>OData Protocol <a
href="http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html">http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html</a></p></li>
<li><p>The OAuth 2.0 Authorization Framework – Authorization Code Grant,
October 2012,Internet Engineering Task Force (IETF) <a
href="https://tools.ietf.org/html/rfc6749%23section-4.1">https://tools.ietf.org/html/rfc6749#section-4.1</a></p>
<ol type="1">
<li><h3 id="applicable-documents">Applicable documents</h3></li>
</ol></li>
</ol>
<ol type="1">
<li><p>Auxiliary Data Interface Delivery Point Specification_v1.1</p>
<ol type="1">
<li><h2 id="terminology">Terminology</h2>
<ol type="1">
<li><h3 id="definitions">Definitions</h3></li>
</ol></li>
</ol></li>
</ol>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Term</strong></th>
<th><strong>Definition</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>API</strong></td>
<td>A set of functions and procedures allowing the creation of
applications that access the features or data of an operating system,
application, or other service.</td>
</tr>
<tr class="even">
<td><strong>AUX_File</strong></td>
<td>Auxiliary file used in a satellite processing chain</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="list-of-acronyms">List of Acronyms </h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="header">
<th>Acronym</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AD</td>
<td>Applicable Document</td>
</tr>
<tr class="even">
<td>UUID</td>
<td>Universally Unique Identifier – Allows to identify an instance</td>
</tr>
<tr class="odd">
<td>JSON</td>
<td>JavaScript Object Notation, commonly used format in web
services</td>
</tr>
<tr class="even">
<td>URI</td>
<td>Uniform Resource Identifier</td>
</tr>
<tr class="odd">
<td>JPA</td>
<td>Java Persistence API</td>
</tr>
<tr class="even">
<td>POM</td>
<td>Project object model</td>
</tr>
</tbody>
</table>
<h1 id="sentinels-reprocessing-preparation-package">SENTINELS
REPROCESSING PREPARATION PACKAGE</h1>
<h2 class="list-paragraph" id="overview">2.1 Overview </h2>
<p>Sentinels Reprocessing Preparation Package prepares the future
Sentinel-1/2/3 reprocessing activities by ensuring that all information
required to reprocess historical data is available and ready to use in
the frame of a reprocessing operations service.</p>
<p>The main activities of Sentinels Reprocessing Preparation Package are
the following tasks:</p>
<ul>
<li><p><strong>Task 1: Build-up of a Reprocessing Configuration
Baseline</strong></p></li>
</ul>
<blockquote>
<p>The scope of this task is to identify for each satellite unit and
product type, the set of auxiliary files to be used for their
reprocessing using the latest available data processor version. The
information shall be recorded in a “Reprocessing Configuration Baseline
Table”.</p>
</blockquote>
<ul>
<li><p><strong>Task 2: Set up a reprocessing auxiliary files interface (
AUXIP API)</strong></p></li>
</ul>
<blockquote>
<p>The Auxiliary Data Interface Delivery Point ( AUXIP ) is the pick-up
point for Sentinel Auxiliary products. The AUXIP allows clients to
discover and retrieve available products through standard the OData
RESTful API interface.</p>
</blockquote>
<ul>
<li><p><strong>Task 3: Build-up of a Reprocessing Data
Baseline</strong></p></li>
</ul>
<blockquote>
<p>The scope of this task is to identify for each satellite unit, and
Level-0 product name and Level-1/2 product type, the applicable up to
date set of auxiliary files to be used for their reprocessing as well as
the latest applicable data processor version.</p>
</blockquote>
<h2 id="sentinels-reprocessing-preparation-package-1"> Sentinels
Reprocessing Preparation Package </h2>
<h1
id="sentinels-reprocessing-preparation-package-interface-context">SENTINELS
REPROCESSING PREPARATION PACKAGE INTERFACE CONTEXT </h1>
<p>Sentinels Reprocessing Preparation package is a set of OData based
RESTful API reinforced with an API gateway (Kong) and an openID Connect
Provider (Keycloak) allowing the security improvement.</p>
<ul>
<li><p>All requests sent to the AUXIP API passes through the
<strong><u>Kong gateway API</u></strong> to check the client
credentials.</p></li>
<li><p>If clients are not authenticated, they will be redirected the
<strong><u>Keycloak interface</u></strong> to create an account or to be
authenticated.</p></li>
<li><p>Client should retrieve the <strong><u>access token</u></strong>
via a Keycloak interface in order to be able to send requests to
reprocessing preparation package services.</p></li>
</ul>
<h1 id="installation-and-deployment-manual">INSTALLATION AND DEPLOYMENT
MANUAL </h1>
<h2 id="overview-1"> Overview</h2>
<p>All services forming the reprocessing preparation package are
implemented as Java projects object models (POM) and all their
dependencies and buildings are managed and simplified using Maven tool.
See the AUXIP API pom.xml file in the appendices.</p>
<p>The installation process of the reprocessing preparation package is
also simplified by dockerizing each service to be able to run it in the
adequate environment making all dependencies available by using the
docker-compose tool.</p>
<p>As mentioned before in the interface context, kong and keycloak shall
be used to reinforce the security system, and Docker Compose will be
used to build and connect all related containers.</p>
<p>At the end, the following containers are built and managed via a
docker-compose.yml file:</p>
<ul>
<li><p>Container for each service of the reprocessing preparation
package.</p></li>
<li><p>Postgresql Database container for each service of the
reprocessing preparation package.</p></li>
<li><p>Kong container</p></li>
<li><p>Keycloak container</p></li>
<li><p>Nginx container (this container can be omitted by using directly
the kong one with an addition configuration.)</p></li>
</ul>
<h2 id="installation-and-deployment-requirements"> Installation and
Deployment requirements </h2>
<p>The Docker engine is mandatory to be able to run the following
installation and deployment process; you should have been installing it
in your target machine.</p>
<h2 id="build-docker-images"> Build docker images </h2>
<p>The first step of the installation process is to build all necessary
docker images. The reprocessing preparation package comes with a
<em>build_all.bash</em> script which allows doing so.</p>
<ul>
<li><p><em>./build_all.bash ( will build docker images for all
services)</em></p></li>
</ul>
<p><strong>Kong Dockerfile</strong>:</p>
<p>To be able to establish a secure connection between kong and Keycloak
, a Kong OpenId connect plugin should be available in the kong docker
image, to do so , the following dockerfile will be used to generate a
final kong image based on the official one :</p>
<blockquote>
<p><em>FROM kong:2.3.3-alpine</em></p>
<p><em>LABEL description="Alpine + Kong 2.3.3 + kong-oidc
plugin"</em></p>
<p><em>USER root</em></p>
<p><em>RUN apk update &amp;&amp; apk add git unzip luarocks</em></p>
<p><em>RUN luarocks install kong-oidc</em></p>
<p><em>RUN luarocks install lua-resty-openidc 1.7.4 --force</em></p>
<p><em>USER kong</em></p>
</blockquote>
<p><strong>Keycloak and postgres images:</strong></p>
<p>Official images available in the Dockerhub will be used.</p>
<h2 id="deployment-as-docker-compose-applications"> Deployment as
docker-compose applications </h2>
<p>The operational reprocessing preparation package comes with a compose
component which contains the docker-compose file (see it in appendices)
of the package for all services and a configuration data folder for the
initial configuration of kong, keycloak and nginx containers.</p>
<p>Deploy the reprocessing preparation package services using:</p>
<ul>
<li><p><em>cd compose/kongkeycloak</em></p></li>
<li><p><em>docker-compose --env-file path_to_env_file up up
-d</em></p></li>
</ul>
<p>The docker-compose contains environment variables to passwords that
will have to be fixed, these passwords can be retrieved from an
environment file to be passed as <em>--env-file option</em> when
launching docker-compose up. (See an example in appendices)</p>
<h1 id="appendices">APPENDICES</h1>
<h2 id="auxip-pom-file"> AUXIP POM file</h2>
<p><a
href="https://github.com/reprocessing-reference/preparation/blob/release-0.0.3/AUXIP_OLINGO/pom.xml">https://github.com/reprocessing-reference/preparation/blob/release-0.0.3/AUXIP_OLINGO/pom.xm<em>l</em></a></p>
<h2 id="auxip-docker-compose-file"> AUXIP docker-compose file</h2>
<p><a
href="https://github.com/reprocessing-reference/preparation/blob/release-0.0.3/compose/kongkeycloak/docker-compose.yml"><em>https://github.com/reprocessing-reference/preparation/blob/release-0.0.3/compose/kongkeycloak/docker-compose.yml</em></a></p>
<h2 id="environments-file">Environments file</h2>
<p><em>KEYCLOAK_PASSWORD="***KEYCLOAK_PASSWORD***"</em></p>
<p><em>REPROBASE_POSTGRES_PASSWORD="**POSTGRES_PASSWORD**"</em></p>
<p><em>AUXIP_POSTGRES_PASSWORD="**AUXIP_POSTGRES_PASSWORD**"</em></p>
<p><em>PGADMIN_DEFAULT_PASSWORD="** PGADMIN_DEFAULT_PASSWORD**"</em></p>
<p><em>KEYCLOAK_POSTGRES_PASSWORD="**KEYCLOAK_POSTGRES_PASSWORD**"</em></p>
<p><em>AUXIP_S3_ACCESS_KEY=JC6XSDLKDPZ1MGLDNTD</em></p>
<p><em>AUXIP_S3_SECRET_KEY=7lmKSLSKS1oqY4WMmAVmfrQVKSGHSeqGJFT4y1</em></p>
<p><em>ROLLING_S3_ACCESS_KEY=HQWODLDJDMWOPK687JDT1JA</em></p>
<p><em>ROLLING_S3_SECRET_KEY=Bu6btWhY4emc0HDldkdbsZDbtJFG0AwWtytHFis</em></p>
<p><em>REPROCESSINGDATABASELINE_POSTGRES_PASSWORD="**
REPROCESSINGDATABASELINE**"</em></p>
<div class="footer-strip">
  <div class="container">
    <div class="row">
      <div class="col-3" style="color: white"><a href="http://github.com/reprocessing-reference/ " style="color:white" target="_blank">Project's Github</a></div>
      <div class="col-7" style="color: white"><a href="" style="color:white" target="_blank"></a></div>
      <div class="col-1"><a href="mailto:{{ site.docurl }}?subject=[General] Commentss&body=Hello, this is some comments about the website" title="Send comments"><span class="ui-icon ui-icon-mail-closed" style="background-color:white"></span></a></div>
      </div>
  </div>
</div>
</body>
</html>
